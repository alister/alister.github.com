
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Avoiding Composer being Rate-limited by Github - Professional Blog</title>
  <meta name="author" content="Alister Bulman">

  
  <meta name="description" content="I&rsquo;ve had a response to my post about &ldquo;Your Own &lsquo;Jenkins&rsquo; for PHP With Composer&rdquo;, via a Github issue :), so I thought I& &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://alister.github.com/blog/2013/10/17/avoiding-composer-being-rate-limited-by-github/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Professional Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37346894-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Professional Blog</a></h1>
  
    <h2>A few things I've been up to</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:alister.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/presentations/">Presentations</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Avoiding Composer Being Rate-limited by Github</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-17T21:30:00+01:00" pubdate data-updated="true">Oct 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;ve had a response to my post about &ldquo;<a href="http://alister.github.io/blog/2013/06/03/your-own-jenkins-for-php-with-composer/">Your Own &lsquo;Jenkins&rsquo; for PHP With Composer</a>&rdquo;, via <a href="https://github.com/alister/alister.github.com/issues/2">a Github issue</a> :), so I thought I&rsquo;d answer that right here as well.</p>

<pre><code>in http://alister.github.io/blog/2013/06/03/your-own-jenkins-for-php-with-composer/
it is using `--prefer-dist` which causes a hit on
`api.github.com/repos/USER/REPO/zipball/SHA1` eg:

    https://api.github.com/repos/serbanghita/Mobile-Detect/zipball/.....

which has a rate limit of 60 per hour. Unfortunately, we currently
have 61 dependencies! Switching to `--prefer-source` works.

Thanks for the blog post, got me a long way on the right track :thumbsup:
</code></pre>

<p>This is a similar problem to one I&rsquo;ve had before, not from too many for a single repo, but while I was testing a composer-based deployment (with Capistrano). In either event, Github has a limit on the number of requests/downloads allowed in a period of time &ndash; here, 60 per hour.</p>

<p>There are two ways to solve this though. The first is quick and easy, but with that ease it also just expands on the potential long-term problems that could happen. It&rsquo;s certainly the first thing to do for a fix though.</p>

<p><a href="#solution-oauth">Quick, Easy and good enough</a> OR <a href="#solution-satis">Solid, reliable and local</a></p>

<p><a id="solution-oauth"></a></p>

<h3>Solution One, Quick, Easy and good enough for most individuals</h3>

<h5>Composer.json&rsquo;s github-oauth option.</h5>

<p>It&rsquo;s not too well known, but is documented on the <a href="http://getcomposer.org/doc/04-schema.md#config">composer schema page</a>.</p>

<pre><code>github-oauth: A list of domain names and oauth keys. For example using
{"github.com": "oauthtoken"} as the value of this option will use
oauthtoken to access private repositories on github and to circumvent
the low IP-based rate limiting of their API.
</code></pre>

<p>I&rsquo;ve not seen the ability to use an Oauth token to be able to download from a VCS before (I&rsquo;ve just looked on <a href="https://bitbucket.org/">Bitbucket.org</a> for example), but according to the docs, that option in composer.json isn&rsquo;t limited to requests from Github.com.</p>

<p>With the OAuth token, the max-rate is <a href="http://developer.github.com/v3/#rate-limiting">increased substantially</a>, to 5000 per hour.</p>

<p>If you search for some online help to be able to generate the token from the command line, it will tell you how to run Curl against Githubs Authorization API:</p>

<pre><code>curl -u 'githubuser' \
-d '{"note":"GitHub OAuth token for composer"}' https://api.github.com/authorizations
</code></pre>

<p>It will also ask your Github password. However, if you have the <a href="">2-factor authentication</a> enabled for logins (and you should) &ndash; that won&rsquo;t help you. You also need to provide it with the request, which is hard work.</p>

<pre><code>curl -u 'alister' -d '{"note":"test token"}' https://api.github.com/authorizations
Enter host password for user 'alister': __secret-password__
{
  "message": "Must specify two-factor authentication OTP code.",
  "documentation_url": "http://developer.github.com/v3/auth#working-with-two-factor-authentication"
}
</code></pre>

<p>There is a far easier way though. <a href="https://github.com/settings/applications">On the web.</a>. Click &lsquo;Create New Token&rsquo;, give it a description, and save it. Be sure to save a copy (put it into your composer.json file) right now though &ndash; as soon as you refresh the page, it will never be shown again.
<a href="/assets/github-personal-asset-tokens.png"><img class="right" src="/assets/github-personal-asset-tokens.png" title="&#34;Create an Oaut token on the website&#34;" alt="&#34;Create an Oaut token on the website&#34;"></a></p>

<p>And that&rsquo;s a lot easier.</p>

<p><a id="solution-satis"></a></p>

<h3>Solution Two, Solid, reliable and local.</h3>

<h5>Your own mini-packagist.org, with Composer-Satis</h5>

<p>The solid solution is <a href="https://packagist.org/packages/composer/satis">Satis</a>, a related-project to the main Composer. This allows you to download a local version of potentially all the dependencies in your composer.json file(s). You also have the option to even have Satis automatically resolve and add all of the sub-dependencies for your projects as well. It&rsquo;s packages all the way down&hellip;.</p>

<p>If you have local, private Github repository (and not just a private repo &ndash; an OAuth key can fetch that), or you want to be able to lock down the network to restrict which packages are allowed to be used (or equally, the machines where the packages would be installed are not able to access the &lsquo;outside world&rsquo;), then Satis will be your best, or maybe even only option.</p>

<p>Setting up Satis and using it, is a bigger event though, so for now I&rsquo;ll just leave you with a few links, and come back to this another time&hellip;.</p>

<ul>
<li><a href="http://getcomposer.org/doc/articles/handling-private-packages-with-satis.md">http://getcomposer.org/doc/articles/handling-private-packages-with-satis.md</a></li>
<li><a href="https://packagist.org/packages/composer/satis">https://packagist.org/packages/composer/satis</a></li>
<li><a href="https://packagist.org/search/?q=satis">https://packagist.org/search/?q=satis</a></li>
<li><a href="https://github.com/yohang/satis-admin">https://github.com/yohang/satis-admin</a></li>
</ul>


<p>Alister</p>

<hr />

<p>My latest project has just been announced &ndash; <a href="http://contractavailability.com/">contractavailability</a>. It does pretty much what it says on the proverbial tin, but take a look at <a href="http://beta.contractavailability.com/u/alister">my own profile</a> there for a little more info.  Sign up to the maining list, and I&rsquo;ll keep you up to date as it comes along.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alister Bulman</span></span>

      








  


<time datetime="2013-10-17T21:30:00+01:00" pubdate data-updated="true">Oct 17<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/composer/'>composer</a>, <a class='category' href='/blog/categories/continuous-integration/'>continuous-integration</a>, <a class='category' href='/blog/categories/jenkins/'>jenkins</a>, <a class='category' href='/blog/categories/php/'>php</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://alister.github.com/blog/2013/10/17/avoiding-composer-being-rate-limited-by-github/" data-via="alister_b" data-counturl="http://alister.github.com/blog/2013/10/17/avoiding-composer-being-rate-limited-by-github/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/08/14/contractor-survey/" title="Previous Post: Contractor Survey">&laquo; Contractor Survey</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/17/avoiding-composer-being-rate-limited-by-github/">Avoiding Composer being Rate-limited by Github</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/14/contractor-survey/">Contractor Survey</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/03/your-own-jenkins-for-php-with-composer/">Your own 'Jenkins' for PHP with Composer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/01/some-people-are-trying-to-get-it/">Some people are trying to get it</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/17/not-having-your-developers-quit-on-you-as-a-service/">Not having your developers quit on you - as a service</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("alister_b", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/alister_b" class="twitter-follow-button" data-show-count="false">Follow @alister_b</a>
  
</section>


<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/alister">@alister</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'alister',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101781345476843821407?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
  <h1>Stack Overflow</h1>
  <a href="http://stackoverflow.com/users/6216/alister-bulman">
  <img src="http://stackoverflow.com/users/flair/6216.png" width="208" height="58" alt="profile for alister-bulman at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for alister-bulman at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
  </a>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Alister Bulman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
